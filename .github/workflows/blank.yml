name: Validate Commit Messages

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  validate-commits:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Fetch commit messages
      run: |
        echo "Fetching commit messages in the pull request..."
        COMMIT_MESSAGES=$(gh pr view ${{ github.event.pull_request.number }} --json commits --jq '.commits[].commit.message')
        echo "Commit messages found:"
        echo "$COMMIT_MESSAGES"
        echo "$COMMIT_MESSAGES" > commit_messages.txt

    - name: Validate commit messages
      run: |
        echo "Validating commit messages..."
        while read -r COMMIT_MESSAGE; do
          echo "Checking: $COMMIT_MESSAGE"
          if [[ ! "$COMMIT_MESSAGE" =~ ^(fix|feat): ]]; then
            echo "‚ùå Error: Commit message does not follow conventional commits!"
            exit 1
          fi
        done < commit_messages.txt
      shell: bash
